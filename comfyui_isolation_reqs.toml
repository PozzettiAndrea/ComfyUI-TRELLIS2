# TRELLIS2 - Isolated Environment Configuration
#
# This file defines the isolated Python environment for TRELLIS2 inference.
# The comfyui-isolation library auto-discovers and loads this file.

[env]
name = "trellis2"
python = "3.10"
cuda = "auto"  # 12.8 for Turing+ (covers 96%+ of ML users)
pytorch_version = "auto"  # 2.8.0 for cu128

[worker]
package = "worker"  # worker/__main__.py (to be created)


[packages]
# Variables available: {cuda_version}, {cuda_short}, {pytorch_version}, {pytorch_short}, {pytorch_mm}

# CUDA extensions - install with --no-deps (wheel metadata has conflicting git deps)
# Direct URLs used because GitHub Pages indices are broken
no_deps = [
    "nvdiffrast @ https://github.com/PozzettiAndrea/nvdiffrast-full-wheels/releases/download/cu{cuda_short}-torch{pytorch_short}/nvdiffrast-0.4.0%2Bcu{cuda_short}torch{pytorch_mm}-cp310-cp310-linux_x86_64.whl",
    "flex_gemm @ https://github.com/PozzettiAndrea/flexgemm-wheels/releases/download/cu{cuda_short}-torch{pytorch_short}/flex_gemm-0.0.1%2Bcu{cuda_short}torch{pytorch_mm}-cp310-cp310-linux_x86_64.whl",
    "cumesh @ https://github.com/PozzettiAndrea/cumesh-wheels/releases/download/cu{cuda_short}-torch{pytorch_short}/cumesh-0.0.1%2Bcu{cuda_short}torch{pytorch_mm}-cp310-cp310-linux_x86_64.whl",
    "o_voxel @ https://github.com/PozzettiAndrea/ovoxel-wheels/releases/download/cu{cuda_short}-torch{pytorch_short}/o_voxel-0.0.1%2Bcu{cuda_short}torch{pytorch_mm}-cp310-cp310-linux_x86_64.whl",
    "nvdiffrec_render @ https://github.com/PozzettiAndrea/nvdiffrec_render-wheels/releases/download/cu{cuda_short}-torch{pytorch_short}/nvdiffrec_render-0.0.1%2Bcu{cuda_short}torch{pytorch_mm}-cp310-cp310-linux_x86_64.whl",
]

requirements = [
    # PyTorch (installed from PyTorch index by comfyui-isolation)
    "torch=={pytorch_version}",

    # HuggingFace ecosystem
    "huggingface_hub>=0.20.0,<1.0.0",
    "hf_transfer",
    "hf_xet",
    "transformers>=4.56.0",
    "safetensors",

    # Image processing
    "pillow>=9.0.0",
    "opencv-python-headless",
    "kornia",
    "imageio>=2.0.0",
    "imageio-ffmpeg>=0.4.0",

    # 3D processing
    "trimesh>=3.0.0",
    "plyfile",

    # ML utilities
    "timm",
    "lpips",
    "einops",

    # General utilities
    "numpy>=1.21.0",
    "easydict",
    "tqdm",
    "zstandard",
    "setuptools",  # Required by triton (flex_gemm dependency)
]


[sources]
# Using direct @ URL syntax in requirements (GitHub Pages indices are broken)
wheel_sources = []
index_urls = []
